<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>The FFAEngine and Autonomous Trading</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Let's learn about the FFAEngine and simulating long/short trading strategies"/>
    <meta name="keywords"
          content="
          personal website,
          portfolio,
          resume,
          personal portfolio,
          online resume,
          personal blog,
          blog,
          algorithmic trading,
          ffaengine,
          fama french three factor model"/>
    <meta name="author" content="Shaurya Chandhoke"/>

    <!-- Safari Tab Coloring -->
    <meta name="theme-color" content="#3d79a4">

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content=""/>
    <meta property="og:image" content=""/>
    <meta property="og:url" content=""/>
    <meta property="og:site_name" content=""/>
    <meta property="og:description" content=""/>
    <meta name="twitter:title" content=""/>
    <meta name="twitter:image" content=""/>
    <meta name="twitter:url" content=""/>
    <meta name="twitter:card" content=""/>

    <link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">

    <!-- Theme style  -->
    <link rel="stylesheet" href="../../css/style.css">

    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="../../js/respond.min.js"></script>
    <![endif]-->

    <!-- Custom Section -->
    <!-- Custom Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../../css/blog-template.css">
    <!-- Latex -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


    <!-- PRISM -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism-tomorrow.css"
          integrity="sha512-PRPGfHKa2eGLwuAFVtaIaC1cOJDqw0zPfr5wWq06Nkt0w/KK6IPMNFwUOj/t6zq3D1vVAskdg18R93pLsxzErA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"
            integrity="sha512-/Swpp6aCQ0smuZ+zpklJqMClcUlvxhpLf9aAcM7JjJrj2waCU4dikm3biOtMVAflOOeniW9qzaNXNrbOAOWFCw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-core.min.js"
            integrity="sha512-LCKPTo0gtJ74zCNMbWw04ltmujpzSR4oW+fgN+Y1YclhM5ZrHCZQAJE4quEodcI/G122sRhSGU2BsSRUZ2Gu3w=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-python.min.js"
            integrity="sha512-AKaNmg8COK0zEbjTdMHJAPJ0z6VeNqvRvH4/d5M4sHJbQQUToMBtodq4HaV4fa+WV2UTfoperElm66c9/8cKmQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/plugins/autoloader/prism-autoloader.min.js"
            integrity="sha512-GP4x8UWxWyh4BMbyJGOGneiTbkrWEF5izsVJByzVLodP8CuJH/n936+yQDMJJrOPUHLgyPbLiGw2rXmdvGdXHA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>
<body>

<div class="fh5co-loader"></div>

<div id="page">
    <header id="fh5co-header" class="fh5co-cover js-fullheight" role="banner"
            style="background-image:url(../../images/blogs/the-ffaengine-and-autonomous-trading/blog-background.jpg);"
            data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-8 col-md-offset-2 text-center">
                    <div class="display-t js-fullheight">
                        <div class="display-tc blog_title js-fullheight animate-box" data-animate-effect="fadeIn">
                            <!-- Enter Title Here -->
                            <h1>The FFAEngine and Autonomous Trading</h1>

                            <!-- Enter Subtitle Here -->
                            <h3><span>Using the Fama French Three-Factor model to understand market sensitivities for simulating trading strategies</span>
                            </h3>

                            <!-- Enter Date Here -->
                            <div id="blog-date">March 17, 2022</div>
                            <p></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="blog-container">
        <div id="blog-content" class="animate-box">
            <section id="blog-introduction">
                <p>
                    The Fama French Three-Factor model is an asset pricing model that's built atop the Capital Asset
                    Pricing model, or <a
                        href="http://mba.tuck.dartmouth.edu/bespeneckbo/default/AFA611-Eckbo%20web%20site/AFA611-S6B-FamaFrench-CAPM-JEP04.pdf"
                        target="_blank">CAPM</a>.
                </p>
                <br>
                <p>
                    Both of these models are used in portfolio management to explain the
                    various attributes that can comprise the price of an asset. In this post, we're going to look into
                    the
                    nuances of the Fama French Three-Factor model and explore a custom engine written in Python 3 that
                    leverages this model to understand some of its sensitivities to drastic changes in the market.
                </p>
            </section>
            <section id="blog-section-1">
                <h2>Understanding the CAPM</h2>
                <p>
                    Let's start off by understanding the CAPM. Introduced in the 1960's by William Sharpe, the CAPM was
                    designed in an effort to understand how non-diversifiable risk can influence the expected return of
                    an asset. The following is the formula of the CAPM.
                </p>
                <p>
                    \[\rho_i = \rho_0 + \beta_{i}^{s}(\rho_m - \rho_0) \]
                    where
                    \[\beta_{i}^{s} = {\mathrm{cov}(R_i, R_m) \over \sigma^{2}_{m}}, \]
                    \(\rho_i\) is the expected return of the asset (not to be confused with the return of the asset
                    denoted by \(R_i\)), \(\rho_0\) is the risk-free rate (typically pulled
                    from stable securities like government bonds),
                    and \(\rho_m\) is the expected return on the market. Subtracting the expected returns between the
                    market and the risk-free rate
                    yields a value known as the <span style="font-style: italic;">market risk premium</span>. The core
                    of the CAPM model lies within
                    \(\beta_{i}^{s}\) which can be described as the sensitivity between the asset and the market's
                    expected excess returns. The linear property of the CAPM allows for useful graphical representations
                    such as the Security Market Line (SML).
                </p>
                <div class="blog-image-center">
                    <div class="blog-image-content">
                        <img src="../../images/blogs/the-ffaengine-and-autonomous-trading/sml-chart.png"
                             alt="Security Market Line example.">
                    </div>
                    <div class="blog-image-caption">An example of the security market line (src: <a
                            href="https://en.wikipedia.org/wiki/Security_market_line" target="_blank">https://en.wikipedia.org/wiki/Security_market_line</a>)
                    </div>
                </div>
            </section>
            <section id="blog-section-2">
                <h2>Building Upon the CAPM</h2>
                <p>
                    In 1992 an extension of the CAPM model was designed by Nobel Laureate Eugene Fama and distinguished
                    professor Kenneth French called the Fama French Three-Factor model. Fama and French decided to
                    incorporate size and value risk parameters to the original model. They made the assertion that two
                    distinct classes of assets tended to perform better than the market: small cap stocks and growth
                    stocks. The following is the modified formula that was introduced by them.
                </p>
                <p>
                    \[\rho_i = \rho_0 + \beta_{i}^{s}(\rho_m - \rho_0) + \beta_{i}^{\text{smb}}\rho_{\text{smb}} +
                    \beta_{i}^{\text{hml}}\rho_{\text{hml}} + \alpha_i\]
                    where \(\beta_{i}^{\text{smb}}\) and \(\beta_{i}^{\text{hml}}\) are the betas corresponding to the
                    sensitivities of the excess returns of small market to big market cap and value to growth assets,
                    respectively. The new parameters introduced are an attempt to capture the reasoning behind the
                    inherent prices of assets, and now explains roughly 90% of diversified portfolio returns.
                </p>
            </section>
            <section id="blog-section-3">
                <h2>Designing the FFAEngine</h2>
                <p>
                    Given what we now know with the Fama French Three-Factor model, I created an allocation engine to
                    price various assets and understand how this model can be used to perform a simple long/short
                    trading strategy. I wanted to observe in particular how it would've behaved during the 2008-2009
                    sub-prime mortgage crisis with several look-back time periods as historical information. In
                    particular, the
                    engine's goal will be to optimize its internal weights to maximize returns while minimizing risk.
                    I've decided to call
                    it the <b>FFAEngine</b>, which stands for the <b>Fama French Allocation Engine</b> and attempts to
                    solve the following optimization problem.
                </p>
                <p>
                    \[
                    \begin{aligned}
                    \min_{\omega \in \mathbb{R}^{n}} \quad & \rho^{T}\omega - \lambda(\omega -
                    \omega_{p})^{T}\Sigma(\omega - \omega_p)\\
                    \textrm{s.t.} \quad & \sum_{i=1}^{n} \beta_{i}^{m} \omega_i = \beta_{T}^{m} \\
                    & \sum_{i=1}^{n} \omega_i = 1 \\
                    & -2 \leq \omega_i \leq 2
                    \end{aligned}
                    \]
                    where
                    \[
                    \begin{aligned}
                    \beta_{i}^{s} &= \frac{\text{cov}(R_i, R_m)}{\sigma^{2}_{m}} \\
                    \beta_{p}^{m} &= \sum_{i = 1}^{n} \beta_{i}^{m}\omega_i = \beta_{T}^{m}
                    \end{aligned}
                    \]

                </p>
                <p>
                    Let's look into what the engine is optimizing. \(\omega\) represents the internal weights the engine
                    will continuously attempt to optimize. Another way to look at these weights are from the long/short
                    strategy perspective; by constraining the values of a given weight to between \(-2\) and \(2\),
                    these weights can represent how much of a single asset we're shorting or going long on. No matter
                    what proportion of assets we short or go long on, the sums of these weights must add up to \(1\).
                    \(\rho^{T}\) is the vector of expected returns of each individual asset contained within your
                    portfolio. In other words, \(\rho^{T}w\) represents the expected return of the portfolio as a whole.
                    \((\omega - \omega_{p})^{T}\Sigma(\omega - \omega_p)\) describes the portfolio's risk, and
                    \(\Sigma\) is a covariance matrix between each asset's expected returns. \(\omega_p\) represents the
                    weights calculated directly before the current iteration, and subtracting it from the current
                    iteration ensures that the weights do not deviate too far from each other. The reason behind this
                    approach is that we'd prefer not to buy or sell assets too frequently as our potential returns would
                    suffer from high frequency trade commissions. With that said, this is tunable based on the
                    penalty hyperparameter \(\lambda\). Finally, the term \(\beta_{T}^{m}\) represents the target beta
                    to meet and is one of the most important parameters as it represents how aggressive the engine
                    should behave. A target beta value closer to \(-1\) for example signals the engine to be as
                    risk-averse as possible, a value closer to \(0\) signals the engine to de-correlate itself from the
                    market, and a value closer to \(1\) signals to be as aggressive as possible.
                </p>
                <h3>Portfolio Sensitivity Tuning</h3>
                <p>
                    The engine will run against a fixed time period between March 1, 2007 to June 30, 2021. The time
                    period itself will be further bifurcated into sub-periods based on the 2008 sub-prime mortgage
                    crisis:
                </p>
                <p>
                    <span style="text-decoration: underline; font-weight: bold;">Pre-Crisis</span>
                    <br>
                <div style="display: flex; justify-content: center; width: 100%;">March 1, 2007 - December 31 2007</div>
                <br>
                <span style="text-decoration: underline; font-weight: bold;">In-Crisis</span>
                <br>
                <div style="display: flex; justify-content: center; width: 100%;">January 1, 2008 - June 30, 2009</div>
                <br>
                <span style="text-decoration: underline; font-weight: bold;">Post-Crisis</span>
                <br>
                <div style="display: flex; justify-content: center; width: 100%;">July 1, 2009 - June 30, 2021</div>
                </p>
                <br>
                <p>
                    Because the engine relies on the returns of each asset, the flexibility of looking back at
                    historical returns is very important when determining the expected returns and covariance matrix.
                    These look-back parameters, alongside the value of the target beta, can be encapsulated within the
                    following notation.
                </p>
                <p>
                    \[
                    \begin{aligned}
                    S_{\rho_{L}}^{\Sigma_{L}}(\beta_{T}^{m})
                    \end{aligned}
                    \]
                </p>
                <p>
                    For example, \(S_{40}^{100}(0.7)\) would mean tuning the engine such that is uses \(100\) days of
                    historical data for the covariance matrix computation, \(40\) days for the expected returns vector,
                    and sets a target beta sensitivity of \(0.7\) (a pretty aggressive trading strategy).
                </p>
                <h2>Running the FFAEngine</h2>
                <div class="blog-image-center" style="margin-top: 10px;">
                    <div class="blog-image-content">
                        <img src="../../images/blogs/the-ffaengine-and-autonomous-trading/ffa-engine-infrastructure.png"
                             alt="The infrastructure of the FFAEngine">
                    </div>
                    <div class="blog-image-caption">
                        An abstract overview of how the FFAEngine operates.
                    </div>
                </div>
                <p>
                    With the way I created the engine I believe the easiest way to import it and begin using it would be
                    through a Jupyter notebook. The engine is simply a Python 3 class and requires some prerequisite
                    information during the instantiation process.
                </p>
                <pre><code class="language-python">from datetime import datetime, timedelta
from computation_engine import FFAEngine

# Create a list of 12 ETF's
tickerList = ['FXE','EWJ','GLD','QQQ','SPY','SHV','DBA','USO','XBI','ILF','EPP','FEZ']

# Create a start and stop time period
start_date = datetime(2007, 3, 1)
end_date = datetime(2021, 6, 30)

# Point to the location of the pre-installed Fama French Data
DATA_DIR = './data/FrenchFarma3Factor_Daily.csv'</code></pre>
                <p>
                    When creating the engine, we can pass all known parameters during the instantiation process to jump
                    start the ticker aggregation process. For example, the following is the engine setup for
                    \(S_{90}^{120}(-0.5)\) using historical data from <b>Pre-Crisis</b>.
                </p>
                <pre><code class="language-python">engine = FFAEngine(tickerList, start_date, end_date, DATA_DIR, 120, 90, 'pre-crisis', -0.5)</code></pre>
                <p>
                    After the ticker data is aggregated and scrubbed, starting the engine will perform the long/short
                    strategy simulation and output a tearsheet of its performance.
                </p>
                <pre><code class="language-python">engine.start()</code></pre>
                <pre>
100%|█████████████████████████████████████████████████████████████| 205/205 [00:05<00:00, 34.30it/s]
Checking optimization weights against constraints
Sum of weights:  1.0
∑𝛽𝑖𝑤𝑖=𝛽𝑇:	 -0.4999999999697884
Performance Summary      S(120 90) 𝛽𝑇(-0.5)
---------------------  --------------------
PnL                              72.1052
Daily Mean                        0.217849
Volatility                        0.0766214
Kurtosis                          3.09326
Sharpe Ratio                      0.0113728
VaR 95%                          -0.115074
CVaR 95%                         -0.175007
                </pre>
                <div class="blog-image-center">
                    <div class="blog-image-content">
                        <img src="../../images/blogs/the-ffaengine-and-autonomous-trading/chart-1.png"
                             alt="">
                    </div>
                    <div class="blog-image-content">
                        <img src="../../images/blogs/the-ffaengine-and-autonomous-trading/chart-2.png"
                             alt="">
                    </div>
                    <div class="blog-image-content">
                        <img src="../../images/blogs/the-ffaengine-and-autonomous-trading/chart-3.png"
                             alt="">
                    </div>
                    <div class="blog-image-caption">
                        A tearsheet outputted from running the engine with the sample parameters.
                    </div>
                </div>
                <p>
                    From here, we can tune the various parameters at our disposal to determine how the engine makes its
                    decisions and rerun. If you'd like to run this engine on your own, feel free to check out
                    <a href="https://github.com/shaurya-chandhoke/ffa-engine" target="_blank">this repository</a>.
                </p>
            </section>
            <h2>Thank you!</h2>
            <p>
                Have any feedback for me? Submit it in <a
                    href="https://github.com/shaurya-chandhoke/shaurya-chandhoke.github.io/issues" target="_blank">my
                github.io repo</a>! I'll
                read it when I can and get started on it as soon as I can. Once I get started on it you can view the
                status of it on the <a
                    href="https://github.com/shaurya-chandhoke/shaurya-chandhoke.github.io/projects/1" target="_blank">project
                Kanban board</a> Any and all feedback is always appreciated.
            </p>
        </div>
    </div>

    <!-- Footer -->
    <div class="blog-footer">
        <div>
            <div style="text-align: center">
                <div style="margin-bottom: 20px;">Thanks for checking out my website!</div>
                <ul class="fh5co-social-icons">
                    <li><a href="https://github.com/shaurya-chandhoke" target="_blank"><i
                            class="icon-github2" style="color: white !important;"></i></a></li>
                    <li><a href="https://open.spotify.com/user/98_diesel?si=58b18e9d0e694635"
                           target="_blank"><i class="icon-spotify" style="color: white !important;"></i></a></li>
                    <li><a href="https://www.linkedin.com/in/shaurya-chandhoke" target="_blank"><i
                            class="icon-linkedin2" style="color: white !important;"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>


<div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="icon-arrow-up22"></i></a>
</div>

<!-- jQuery -->
<script src="../../js/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="../../js/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="../../js/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="../../js/jquery.waypoints.min.js"></script>
<!-- Stellar Parallax -->
<script src="../../js/jquery.stellar.min.js"></script>
<!-- Easy PieChart -->
<script src="../../js/jquery.easypiechart.min.js"></script>
<!-- Google Map -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCefOgb1ZWqYtj7raVSmN4PL2WkTrc-KyA&sensor=false"></script>
<script src="../../js/google_map.js"></script>

<!-- Main -->
<script src="../../js/main.js"></script>

</body>
</html>

